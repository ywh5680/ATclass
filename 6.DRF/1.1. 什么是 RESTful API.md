## 什么是 RESTful API

RESTful API 是一种基于 REST（Representational State Transfer）架构风格的 Web API 设计规范。它提供了一种标准化的方式来构建和使用 Web 服务。

### REST 架构的核心概念

#### 1. 资源（Resources）

REST 将一切视为资源，每个资源都有唯一的标识符（URI）。

```http
# 用户资源
GET /api/users/          # 获取用户列表
GET /api/users/1/        # 获取特定用户
POST /api/users/         # 创建新用户
PUT /api/users/1/        # 更新用户
DELETE /api/users/1/     # 删除用户

# 文章资源
GET /api/articles/       # 获取文章列表
GET /api/articles/1/     # 获取特定文章
POST /api/articles/      # 创建新文章
PUT /api/articles/1/     # 更新文章
DELETE /api/articles/1/  # 删除文章
```

#### 2. HTTP 方法

RESTful API 使用标准的 HTTP 方法来表示不同的操作：

- **GET**：获取资源（读取）
- **POST**：创建资源（创建）
- **PUT**：更新资源（完整更新）
- **PATCH**：部分更新资源（部分更新）
- **DELETE**：删除资源（删除）

#### 3. 无状态（Stateless）

每个请求都包含处理该请求所需的所有信息，服务器不保存客户端状态。

```http
# 有状态（不推荐）
GET /api/users/1/profile
# 服务器需要记住用户1的会话状态

# 无状态（推荐）
GET /api/users/1/profile
Authorization: Bearer <token>
# 每个请求都包含认证信息
```

#### 4. 统一接口（Uniform Interface）

所有 API 都遵循相同的接口规范：

```http
# 统一的响应格式
{
    "status": "success",
    "data": {
        "id": 1,
        "name": "张三",
        "email": "zhangsan@example.com"
    },
    "message": "用户获取成功"
}

# 统一的错误格式
{
    "status": "error",
    "error": {
        "code": 404,
        "message": "用户不存在"
    }
}
```

### RESTful API 的设计原则

#### 1. 使用名词而非动词

```http
# 不推荐（使用动词）
GET /api/getUsers
POST /api/createUser
PUT /api/updateUser
DELETE /api/deleteUser

# 推荐（使用名词）
GET /api/users
POST /api/users
PUT /api/users/1
DELETE /api/users/1
```

#### 2. 使用复数名词

```http
# 推荐使用复数形式
GET /api/users/        # 而不是 /api/user/
GET /api/articles/     # 而不是 /api/article/
GET /api/categories/   # 而不是 /api/category/
```

#### 3. 使用嵌套资源表示关联关系

```http
# 用户和文章的关系
GET /api/users/1/articles/          # 获取用户1的所有文章
GET /api/users/1/articles/5/        # 获取用户1的第5篇文章
POST /api/users/1/articles/         # 为用户1创建新文章

# 文章和评论的关系
GET /api/articles/1/comments/       # 获取文章1的所有评论
POST /api/articles/1/comments/      # 为文章1添加评论
```

#### 4. 使用查询参数进行过滤和分页

```http
# 过滤
GET /api/users?status=active
GET /api/articles?category=tech&author=1

# 分页
GET /api/articles?page=1&size=10
GET /api/users?offset=20&limit=10

# 排序
GET /api/articles?sort=created_at&order=desc
GET /api/users?sort=name&order=asc

# 搜索
GET /api/articles?search=django
GET /api/users?q=张三
```

### HTTP 状态码的使用

RESTful API 使用标准的 HTTP 状态码来表示请求结果：

#### 2xx 成功
- **200 OK**：请求成功
- **201 Created**：资源创建成功
- **204 No Content**：请求成功但无返回内容

#### 3xx 重定向
- **301 Moved Permanently**：资源永久移动
- **302 Found**：资源临时移动

#### 4xx 客户端错误
- **400 Bad Request**：请求格式错误
- **401 Unauthorized**：未认证
- **403 Forbidden**：无权限
- **404 Not Found**：资源不存在
- **422 Unprocessable Entity**：请求格式正确但语义错误

#### 5xx 服务器错误
- **500 Internal Server Error**：服务器内部错误
- **502 Bad Gateway**：网关错误
- **503 Service Unavailable**：服务不可用

### 实际示例

#### 用户管理 API

```http
# 获取用户列表
GET /api/users
Response: 200 OK
{
    "status": "success",
    "data": [
        {
            "id": 1,
            "username": "zhangsan",
            "email": "zhangsan@example.com",
            "created_at": "2023-01-01T00:00:00Z"
        },
        {
            "id": 2,
            "username": "lisi",
            "email": "lisi@example.com",
            "created_at": "2023-01-02T00:00:00Z"
        }
    ],
    "pagination": {
        "page": 1,
        "size": 10,
        "total": 2,
        "pages": 1
    }
}

# 创建新用户
POST /api/users
Content-Type: application/json
{
    "username": "wangwu",
    "email": "wangwu@example.com",
    "password": "password123"
}
Response: 201 Created
{
    "status": "success",
    "data": {
        "id": 3,
        "username": "wangwu",
        "email": "wangwu@example.com",
        "created_at": "2023-01-03T00:00:00Z"
    },
    "message": "用户创建成功"
}

# 获取特定用户
GET /api/users/1
Response: 200 OK
{
    "status": "success",
    "data": {
        "id": 1,
        "username": "zhangsan",
        "email": "zhangsan@example.com",
        "profile": {
            "avatar": "https://example.com/avatar.jpg",
            "bio": "软件工程师"
        },
        "created_at": "2023-01-01T00:00:00Z"
    }
}

# 更新用户
PUT /api/users/1
Content-Type: application/json
{
    "username": "zhangsan_updated",
    "email": "zhangsan_new@example.com"
}
Response: 200 OK
{
    "status": "success",
    "data": {
        "id": 1,
        "username": "zhangsan_updated",
        "email": "zhangsan_new@example.com",
        "updated_at": "2023-01-03T12:00:00Z"
    },
    "message": "用户更新成功"
}

# 删除用户
DELETE /api/users/1
Response: 204 No Content
```

#### 文章管理 API

```http
# 获取文章列表（带过滤和分页）
GET /api/articles?category=tech&page=1&size=5
Response: 200 OK
{
    "status": "success",
    "data": [
        {
            "id": 1,
            "title": "Django REST Framework 入门",
            "content": "DRF 是一个强大的工具...",
            "author": {
                "id": 1,
                "username": "zhangsan"
            },
            "category": "tech",
            "created_at": "2023-01-01T00:00:00Z"
        }
    ],
    "pagination": {
        "page": 1,
        "size": 5,
        "total": 1,
        "pages": 1
    }
}

# 获取文章详情
GET /api/articles/1
Response: 200 OK
{
    "status": "success",
    "data": {
        "id": 1,
        "title": "Django REST Framework 入门",
        "content": "DRF 是一个强大的工具...",
        "author": {
            "id": 1,
            "username": "zhangsan"
        },
        "category": "tech",
        "tags": ["django", "api", "python"],
        "comments_count": 5,
        "created_at": "2023-01-01T00:00:00Z",
        "updated_at": "2023-01-02T00:00:00Z"
    }
}

# 获取文章的评论
GET /api/articles/1/comments
Response: 200 OK
{
    "status": "success",
    "data": [
        {
            "id": 1,
            "content": "很好的文章！",
            "author": {
                "id": 2,
                "username": "lisi"
            },
            "created_at": "2023-01-01T10:00:00Z"
        }
    ]
}
```

### RESTful API 的优势

#### 1. 标准化

- 使用标准的 HTTP 方法和状态码
- 统一的接口设计规范
- 易于理解和维护

#### 2. 可扩展性

- 支持多种客户端（Web、移动端、桌面端）
- 易于添加新功能
- 支持版本控制

#### 3. 无状态

- 服务器不保存客户端状态
- 易于水平扩展
- 提高系统可靠性

#### 4. 缓存友好

- 支持 HTTP 缓存机制
- 提高性能
- 减少服务器负载

#### 5. 语言无关

- 支持多种编程语言
- 跨平台兼容
- 易于集成

### 最佳实践

#### 1. 版本控制

```http
# URL 版本控制
GET /api/v1/users
GET /api/v2/users

# Header 版本控制
GET /api/users
Accept: application/vnd.company.app-v1+json
```

#### 2. 认证和授权

```http
# Bearer Token
GET /api/users
Authorization: Bearer <token>

# API Key
GET /api/users
X-API-Key: <api_key>
```

#### 3. 错误处理

```json
{
    "status": "error",
    "error": {
        "code": "VALIDATION_ERROR",
        "message": "输入数据验证失败",
        "details": {
            "email": ["邮箱格式不正确"],
            "password": ["密码长度至少8位"]
        }
    }
}
```

#### 4. 文档化

- 使用 OpenAPI/Swagger 规范
- 提供详细的 API 文档
- 包含请求和响应示例

### 总结

RESTful API 是一种成熟、标准化的 Web API 设计方法，它提供了一套完整的设计原则和最佳实践。通过遵循这些原则，可以构建出易于理解、维护和扩展的 API 服务。

在接下来的学习中，我们将使用 Django REST Framework 来实现这些 RESTful API 设计原则，构建功能强大、性能优良的 Web API。 