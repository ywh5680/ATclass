## 创建项目分支

分支（Branch）是 Git 的核心功能之一，它允许你在不影响主代码的情况下进行开发。本章将详细介绍如何创建和管理项目分支。

### 分支基础

#### 1. 什么是分支

分支是 Git 中指向某个提交的指针，具有以下特点：

- **独立开发**：每个分支可以独立开发功能
- **快速切换**：可以在分支间快速切换
- **安全隔离**：不会影响主分支的稳定性
- **并行开发**：多个开发者可以同时在不同分支工作

#### 2. 分支的优势

- **功能隔离**：新功能在独立分支开发
- **版本管理**：不同版本可以并行维护
- **团队协作**：避免代码冲突
- **实验安全**：可以安全地尝试新想法

### 分支类型

#### 1. 主分支

```bash
# 查看当前分支
git branch

# 查看所有分支
git branch -a

# 主分支通常名为 main 或 master
# main  - 现代 Git 的默认主分支名
# master - 传统的主分支名
```

#### 2. 开发分支

```bash
# 开发分支用于集成功能
# develop - 开发集成分支
# staging - 测试分支
# release - 发布分支
```

#### 3. 功能分支

```bash
# 功能分支用于开发特定功能
# feature/xxx - 功能分支
# bugfix/xxx - 修复分支
# hotfix/xxx - 紧急修复分支
```

### 创建分支

#### 1. 基本分支创建

```bash
# 创建新分支（不切换）
git branch feature-login

# 创建并切换到新分支
git checkout -b feature-login

# 使用新语法创建并切换分支
git switch -c feature-login

# 从特定提交创建分支
git branch feature-login <commit-hash>

# 从特定分支创建分支
git branch feature-login develop
```

#### 2. 分支命名规范

```bash
# 功能分支
git branch feature/user-authentication
git branch feature/payment-integration
git branch feature/admin-dashboard

# 修复分支
git branch bugfix/login-error
git branch bugfix/database-connection
git branch bugfix/memory-leak

# 紧急修复分支
git branch hotfix/security-vulnerability
git branch hotfix/critical-bug

# 发布分支
git branch release/v1.2.0
git branch release/v2.0.0
```

#### 3. 从远程分支创建

```bash
# 从远程分支创建本地分支
git checkout -b feature-login origin/feature-login

# 或者先获取远程分支信息
git fetch origin
git checkout -b feature-login origin/feature-login

# 设置上游分支
git branch --set-upstream-to=origin/feature-login feature-login
```

### 分支操作

#### 1. 切换分支

```bash
# 切换到现有分支
git checkout main
git checkout develop
git checkout feature-login

# 使用新语法切换分支
git switch main
git switch develop
git switch feature-login

# 切换到上一个分支
git checkout -
git switch -
```

#### 2. 查看分支

```bash
# 查看本地分支
git branch

# 查看所有分支（本地和远程）
git branch -a

# 查看远程分支
git branch -r

# 查看分支详细信息
git branch -v

# 查看合并状态
git branch --merged
git branch --no-merged
```

#### 3. 删除分支

```bash
# 删除已合并的分支
git branch -d feature-login

# 强制删除分支（即使未合并）
git branch -D feature-login

# 删除远程分支
git push origin --delete feature-login

# 或者推送空分支来删除
git push origin :feature-login
```

### 分支管理策略

#### 1. Git Flow 工作流

```bash
# 主分支结构
main (master)     # 生产环境代码
develop           # 开发集成分支
feature/*         # 功能分支
release/*         # 发布分支
hotfix/*          # 紧急修复分支

# 创建功能分支
git checkout develop
git pull origin develop
git checkout -b feature/new-feature

# 完成功能开发后
git checkout develop
git merge feature/new-feature
git branch -d feature/new-feature
```

#### 2. GitHub Flow 工作流

```bash
# 简化的工作流
main              # 主分支
feature/*         # 功能分支

# 从主分支创建功能分支
git checkout main
git pull origin main
git checkout -b feature/new-feature

# 开发完成后创建 Pull Request
# 通过代码审查后合并到主分支
```

#### 3. 分支保护

```bash
# 设置分支保护规则（在 GitHub/GitLab 中）
# 1. 禁止直接推送到主分支
# 2. 要求 Pull Request 审查
# 3. 要求状态检查通过
# 4. 禁止强制推送
```

### 分支开发流程

#### 1. 开始新功能

```bash
# 1. 确保主分支是最新的
git checkout main
git pull origin main

# 2. 创建功能分支
git checkout -b feature/user-profile

# 3. 开始开发
# 编辑文件...
git add .
git commit -m "Add user profile feature"

# 4. 推送到远程
git push -u origin feature/user-profile
```

#### 2. 持续开发

```bash
# 在功能分支上继续开发
git add .
git commit -m "Update user profile validation"

# 推送更新
git push origin feature/user-profile

# 如果需要获取主分支的最新更改
git checkout main
git pull origin main
git checkout feature/user-profile
git merge main
```

#### 3. 完成功能

```bash
# 1. 确保代码是最新的
git checkout main
git pull origin main
git checkout feature/user-profile
git merge main

# 2. 解决冲突（如果有）
# 编辑冲突文件...
git add .
git commit -m "Resolve merge conflicts"

# 3. 推送到远程
git push origin feature/user-profile

# 4. 创建 Pull Request
# 在 GitHub/GitLab 中创建 PR
```

### 分支合并

#### 1. 合并分支

```bash
# 切换到目标分支
git checkout main

# 合并功能分支
git merge feature/user-profile

# 删除功能分支
git branch -d feature/user-profile

# 推送到远程
git push origin main
```

#### 2. 合并策略

```bash
# 快进合并（默认）
git merge feature/user-profile

# 创建合并提交
git merge --no-ff feature/user-profile

# 压缩合并
git merge --squash feature/user-profile
git commit -m "Add user profile feature"
```

#### 3. 解决合并冲突

```bash
# 合并时发生冲突
git merge feature/user-profile
# 显示冲突文件

# 手动解决冲突
# 编辑冲突文件...
git add .
git commit -m "Resolve merge conflicts"

# 或者中止合并
git merge --abort
```

### 分支最佳实践

#### 1. 分支命名

```bash
# 使用描述性的名称
feature/user-authentication
bugfix/login-validation-error
hotfix/security-patch
release/v1.2.0

# 避免使用
feature/123
bugfix/fix
temp
```

#### 2. 分支生命周期

```bash
# 1. 创建分支
git checkout -b feature/new-feature

# 2. 开发功能
# 编写代码...
git add .
git commit -m "Add new feature"

# 3. 推送分支
git push -u origin feature/new-feature

# 4. 创建 Pull Request
# 在 Web 界面创建 PR

# 5. 代码审查
# 团队成员审查代码

# 6. 合并分支
# 通过 PR 合并到主分支

# 7. 删除分支
git branch -d feature/new-feature
git push origin --delete feature/new-feature
```

#### 3. 分支管理

```bash
# 定期清理分支
git branch --merged | grep -v "\*" | xargs -n 1 git branch -d

# 查看分支状态
git for-each-ref --format='%(refname:short) %(upstream:short)' refs/heads

# 同步远程分支
git fetch --prune
```

### 高级分支技巧

#### 1. 分支重命名

```bash
# 重命名本地分支
git branch -m old-name new-name

# 重命名远程分支
git push origin :old-name
git push origin new-name
git push origin -u new-name
```

#### 2. 分支比较

```bash
# 比较两个分支
git diff main..feature/user-profile

# 查看分支差异
git log main..feature/user-profile

# 查看文件差异
git diff main..feature/user-profile -- path/to/file
```

#### 3. 分支备份

```bash
# 创建分支备份
git branch backup/feature-user-profile feature/user-profile

# 创建标签
git tag v1.0.0 feature/user-profile

# 导出分支
git archive --format=zip --output=feature-user-profile.zip feature/user-profile
```

### 常见问题解决

#### 1. 分支冲突

```bash
# 查看冲突文件
git status

# 解决冲突
# 编辑冲突文件...
git add .
git commit -m "Resolve conflicts"

# 或者中止操作
git merge --abort
git rebase --abort
```

#### 2. 分支丢失

```bash
# 查看最近的操作
git reflog

# 恢复丢失的分支
git checkout -b feature-lost <commit-hash>

# 查看所有引用
git show-ref
```

#### 3. 远程分支同步

```bash
# 获取远程分支信息
git fetch origin

# 同步远程分支
git remote prune origin

# 更新本地分支
git pull origin main
```

### 总结

通过本章的学习，你应该掌握了：

1. **分支基础**：理解分支的概念和优势
2. **分支类型**：了解不同类型分支的用途
3. **分支创建**：创建各种类型的分支
4. **分支操作**：切换、查看、删除分支
5. **工作流程**：使用不同的分支管理策略
6. **分支合并**：合并分支和解决冲突
7. **最佳实践**：遵循分支管理的最佳实践

分支是 Git 协作开发的核心，掌握这些技能将大大提高你的开发效率和团队协作能力。