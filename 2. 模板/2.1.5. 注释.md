## 模板注释

Django模板系统提供了灵活的注释功能，允许开发者在模板中添加说明、调试信息或者临时禁用代码块。注释不会出现在最终的HTML输出中，只对开发者可见。

### 注释类型

#### 1. 单行注释

使用`{# #}`语法创建单行注释：

```html
{# 这是一个单行注释 #}
<p>This is visible content.</p>

{# 用户信息显示 #}
<div class="user-info">
    <p>Name: {{ user.name }}</p>
    <p>Email: {{ user.email }}</p>
</div>

{# TODO: 添加用户头像显示功能 #}
<!-- <img src="{{ user.avatar }}" alt="User Avatar"> -->
```

#### 2. 多行注释

使用`{% comment %}`标签创建多行注释：

```html
{% comment %}
    这是一个多行注释
    可以包含多行内容
    不会被渲染到HTML中
    
    用途：
    - 解释复杂的模板逻辑
    - 临时禁用代码块
    - 添加开发说明
{% endcomment %}

<p>This content is visible.</p>
```

### 注释的用途

#### 1. 代码说明

```html
{# 显示用户列表，最多显示10个用户 #}
{% for user in users|slice:":10" %}
    <li>{{ user.username }}</li>
{% endfor %}

{# 如果用户已登录，显示个人信息；否则显示登录链接 #}
{% if user.is_authenticated %}
    <div class="profile">
        <p>Welcome, {{ user.username }}!</p>
    </div>
{% else %}
    <a href="{% url 'login' %}">Please login</a>
{% endif %}
```

#### 2. 临时禁用代码

```html
{# 临时禁用搜索功能
<form method="get" action="{% url 'search' %}">
    <input type="text" name="q" placeholder="Search...">
    <button type="submit">Search</button>
</form>
#}

{# 临时禁用分页
{% if is_paginated %}
    <div class="pagination">
        <!-- 分页代码 -->
    </div>
{% endif %}
#}
```

#### 3. 调试信息

```html
{# DEBUG: 显示当前用户信息
当前用户: {{ user }}
用户权限: {{ user.get_all_permissions }}
用户组: {{ user.groups.all }}
#}

{# DEBUG: 显示上下文变量
可用变量: {{ context_vars }}
#}
```

#### 4. 开发说明

```html
{% comment %}
    这个模板用于显示博客文章列表
    
    需要的上下文变量：
    - posts: 文章列表（QuerySet）
    - is_paginated: 是否分页（布尔值）
    - page_obj: 分页对象
    
    模板继承：
    - 继承自 base.html
    - 覆盖 content 块
    
    注意事项：
    - 确保 posts 不为空
    - 处理分页逻辑
    - 添加适当的CSS类
{% endcomment %}
```

### 注释的最佳实践

#### 1. 清晰明了

```html
{# 好的注释示例 #}
{# 显示用户头像，如果用户没有头像则显示默认图片 #}
{% if user.avatar %}
    <img src="{{ user.avatar.url }}" alt="User Avatar">
{% else %}
    <img src="{% static 'images/default-avatar.png' %}" alt="Default Avatar">
{% endif %}

{# 不好的注释示例 #}
{# 显示头像 #}
{% if user.avatar %}
    <img src="{{ user.avatar.url }}" alt="User Avatar">
{% else %}
    <img src="{% static 'images/default-avatar.png' %}" alt="Default Avatar">
{% endif %}
```

#### 2. 解释复杂逻辑

```html
{# 复杂的条件判断：检查用户是否有权限编辑文章
   1. 用户必须是文章作者
   2. 或者用户是超级用户
   3. 或者用户是编辑人员且文章状态为草稿
#}
{% if user == article.author or user.is_superuser or user.is_staff and article.status == 'draft' %}
    <a href="{% url 'edit-article' article.id %}" class="btn btn-edit">Edit</a>
{% endif %}
```

#### 3. 标记待办事项

```html
{# TODO: 添加文章分享功能 #}
{# FIXME: 修复移动端显示问题 #}
{# HACK: 临时解决方案，需要重构 #}
{# NOTE: 这个功能将在下个版本中实现 #}

{# 示例：标记待办事项 #}
{# TODO: 实现文章搜索功能
   需要添加：
   - 搜索表单
   - 搜索结果页面
   - 搜索历史记录
#}
```

#### 4. 版本控制信息

```html
{# 版本: 1.2.0
   更新日期: 2023-12-01
   更新内容: 添加用户头像显示功能
#}

{# 变更记录:
   v1.1.0: 添加分页功能
   v1.0.0: 初始版本
#}
```

### 注释的注意事项

#### 1. 不要过度注释

```html
{# 过度注释的示例 #}
{# 这是一个段落标签 #}
<p>Hello World</p>
{# 这是一个换行标签 #}
<br>
{# 这是一个链接标签 #}
<a href="#">Link</a>

{# 适当的注释示例 #}
<p>Hello World</p>
<br>
{# 导航链接 #}
<a href="#">Link</a>
```

#### 2. 避免过时的注释

```html
{# 过时的注释 #}
{# 这个功能将在下周实现 #}  {# 已经过时了 #}

{# 保持注释的时效性 #}
{# 这个功能计划在v2.0中实现 #}
```

#### 3. 注释要准确

```html
{# 不准确的注释 #}
{# 显示所有用户 #}
{% for user in users|slice:":5" %}  {# 实际只显示5个用户 #}

{# 准确的注释 #}
{# 显示前5个用户 #}
{% for user in users|slice:":5" %}
```

### 高级注释技巧

#### 1. 条件注释

```html
{# 根据环境显示不同的注释 #}
{% if debug %}
    {# 开发环境：显示调试信息 #}
    <div class="debug-info">
        <p>Debug mode: ON</p>
        <p>Current user: {{ user }}</p>
    </div>
{% else %}
    {# 生产环境：隐藏调试信息 #}
{% endif %}
```

#### 2. 模板继承中的注释

```html
{# base.html #}
<!DOCTYPE html>
<html>
<head>
    <title>{% block title %}Default Title{% endblock %}</title>
</head>
<body>
    {# 主要内容区域 #}
    {% block content %}
        {# 默认内容 #}
        <p>Default content</p>
    {% endblock %}
</body>
</html>

{# child.html #}
{% extends "base.html" %}

{# 覆盖标题块 #}
{% block title %}Child Page Title{% endblock %}

{# 覆盖内容块 #}
{% block content %}
    {# 子页面特定内容 #}
    <h1>Child Page Content</h1>
    <p>This is the child page content.</p>
{% endblock %}
```

#### 3. 包含模板中的注释

```html
{# header.html #}
{# 页面头部模板 #}
<header class="site-header">
    {# 网站标题 #}
    <h1 class="site-title">{{ site_name }}</h1>
    
    {# 导航菜单 #}
    <nav class="main-nav">
        <ul>
            <li><a href="{% url 'home' %}">Home</a></li>
            <li><a href="{% url 'about' %}">About</a></li>
        </ul>
    </nav>
</header>

{# 在主模板中使用 #}
{% comment %}
    包含页面头部
    传递的上下文变量：
    - site_name: 网站名称
{% endcomment %}
{% include "header.html" %}
```

### 调试和开发中的注释

#### 1. 调试变量

```html
{# 调试：显示所有可用的上下文变量 #}
{% comment %}
    调试信息 - 开发完成后删除
    当前用户: {{ user }}
    用户权限: {{ user.get_all_permissions }}
    请求路径: {{ request.path }}
    请求方法: {{ request.method }}
{% endcomment %}
```

#### 2. 性能测试

```html
{# 性能测试：测量循环性能 #}
{% comment %}
    性能测试开始
    循环项目数: {{ items|length }}
    开始时间: {{ "now"|date:"H:i:s" }}
{% endcomment %}

{% for item in items %}
    <li>{{ item.name }}</li>
{% endfor %}

{% comment %}
    性能测试结束
    结束时间: {{ "now"|date:"H:i:s" }}
{% endcomment %}
```

### 注释的清理

#### 1. 生产环境清理

在部署到生产环境之前，应该清理不必要的注释：

```html
{# 开发环境保留的注释 #}
{# 用户认证检查 #}
{% if user.is_authenticated %}
    <p>Welcome, {{ user.username }}!</p>
{% endif %}

{# 生产环境应该删除的注释 #}
{# DEBUG: 显示用户ID: {{ user.id }} #}
{# TODO: 添加用户头像功能 #}
{# FIXME: 临时解决方案 #}
```

#### 2. 自动化清理

可以使用脚本自动清理注释：

```python
# cleanup_comments.py
import re

def cleanup_template_comments(content):
    """清理模板中的调试和开发注释"""
    
    # 移除DEBUG注释
    content = re.sub(r'\{# DEBUG:.*?#\}', '', content, flags=re.DOTALL)
    
    # 移除TODO注释
    content = re.sub(r'\{# TODO:.*?#\}', '', content, flags=re.DOTALL)
    
    # 移除FIXME注释
    content = re.sub(r'\{# FIXME:.*?#\}', '', content, flags=re.DOTALL)
    
    return content
```

## 小结

- Django模板支持两种注释方式：`{# #}`和`{% comment %}`
- 注释不会出现在最终的HTML输出中
- 注释应该清晰明了，解释复杂的模板逻辑
- 使用注释标记待办事项、版本信息和调试信息
- 在部署到生产环境前清理不必要的注释
- 注释是提高代码可维护性的重要工具