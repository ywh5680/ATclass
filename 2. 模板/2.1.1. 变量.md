## 模板变量

Django模板中的变量用于输出动态内容。变量使用双大括号语法`{{ variable }}`，当模板引擎遇到变量时，会计算其值并插入到输出中。

### 基本变量

最基本的变量使用方式：

```html
<h1>Hello, {{ name }}</h1>
<p>Welcome to {{ site_name }}</p>
```

如果`name`的值为"John"，`site_name`的值为"My Blog"，则输出为：
```html
<h1>Hello, John</h1>
<p>Welcome to My Blog</p>
```

### 变量属性访问

可以使用点号访问对象的属性：

```html
<p>Article title: {{ article.title }}</p>
<p>Author: {{ article.author.name }}</p>
<p>Published: {{ article.published_date|date:"F j, Y" }}</p>
```

如果`article`对象有`title`属性，`author`对象有`name`属性，则会正确显示这些值。

### 字典查找

可以使用方括号语法访问字典值：

```html
<p>User age: {{ user_data.age }}</p>
<p>User city: {{ user_data.city }}</p>
```

如果`user_data`是一个字典，包含`age`和`city`键，则会显示对应的值。

### 列表索引

可以使用方括号和数字访问列表元素：

```html
<p>First item: {{ items.0 }}</p>
<p>Second item: {{ items.1 }}</p>
<p>Last item: {{ items|last }}</p>
```

注意：Django模板不支持负索引（如`items.-1`），但可以使用过滤器如`last`来获取最后一个元素。

### 变量查找规则

当Django遇到模板变量时，会按以下顺序查找：

1. **字典查找**：如`foo["bar"]`
2. **属性查找**：如`foo.bar`
3. **列表索引查找**：如`foo[bar]`

如果所有查找都失败，Django会：
- 如果`TEMPLATE_DEBUG`为`True`，显示错误页面
- 如果`TEMPLATE_DEBUG`为`False`，输出空字符串

### 变量作用域

在模板中，变量有特定的作用域：

- 从视图传递的上下文变量
- 模板标签中定义的变量
- 循环变量（如`forloop.counter`）

```html
{% for item in items %}
    <p>{{ forloop.counter }}. {{ item.name }}</p>
    {% if forloop.first %}
        <p>This is the first item: {{ item.name }}</p>
    {% endif %}
{% endfor %}
```

### 变量过滤

变量可以与过滤器结合使用：

```html
<p>Original: {{ name }}</p>
<p>Uppercase: {{ name|upper }}</p>
<p>Lowercase: {{ name|lower }}</p>
<p>Title case: {{ name|title }}</p>
```

### 变量默认值

使用`default`过滤器为变量设置默认值：

```html
<p>User bio: {{ user.bio|default:"No bio available" }}</p>
<p>User age: {{ user.age|default:"Age not specified" }}</p>
```

### 变量长度

获取列表或字符串的长度：

```html
<p>Total items: {{ items|length }}</p>
<p>Name length: {{ name|length }}</p>
```

### 变量条件显示

结合条件标签使用变量：

```html
{% if user.is_authenticated %}
    <p>Welcome back, {{ user.username }}!</p>
    <p>Last login: {{ user.last_login|date:"F j, Y" }}</p>
{% else %}
    <p>Please <a href="{% url 'login' %}">login</a> to continue.</p>
{% endif %}
```

### 变量在表单中的使用

在表单中预填充变量值：

```html
<form method="post">
    {% csrf_token %}
    <label for="title">Title:</label>
    <input type="text" id="title" name="title" value="{{ form.title.value|default:'' }}">
    
    <label for="content">Content:</label>
    <textarea id="content" name="content">{{ form.content.value|default:'' }}</textarea>
    
    <button type="submit">Submit</button>
</form>
```

### 变量在URL中的使用

使用变量构建动态URL：

```html
<a href="{% url 'article-detail' article.id %}">{{ article.title }}</a>
<a href="{% url 'user-profile' user.username %}">{{ user.get_full_name|default:user.username }}</a>
```

### 变量调试

在开发过程中，可以使用以下方式调试变量：

```html
<!-- 显示变量的原始值 -->
<p>Debug: {{ variable }}</p>

<!-- 显示变量的类型 -->
<p>Type: {{ variable|pprint }}</p>

<!-- 显示变量的详细信息 -->
<pre>{{ variable|pprint }}</pre>
```

### 常见问题

1. **变量不存在**：如果变量不存在，Django会输出空字符串
2. **属性访问错误**：如果对象没有某个属性，会输出空字符串
3. **方法调用**：模板中不能直接调用方法，需要在视图中处理
4. **复杂逻辑**：复杂的业务逻辑应该在视图中处理，而不是在模板中

### 最佳实践

1. **保持简单**：模板中的变量应该简单明了
2. **预处理数据**：在视图中预处理复杂的数据结构
3. **使用过滤器**：利用过滤器来格式化变量
4. **错误处理**：为可能不存在的变量提供默认值
5. **性能考虑**：避免在模板中进行复杂计算

## 小结

- Django模板变量使用`{{ }}`语法
- 支持属性访问、字典查找和列表索引
- 变量查找遵循特定的规则和顺序
- 可以与过滤器结合使用
- 应该保持简单，复杂逻辑在视图中处理
