## 模板标签

Django模板标签用于执行控制流、循环、条件判断等操作。标签使用`{% %}`语法，可以包含参数和结束标签。

### 条件标签

#### if标签

最基本的条件判断标签：

```html
{% if user.is_authenticated %}
    <p>Welcome, {{ user.username }}!</p>
    <a href="{% url 'logout' %}">Logout</a>
{% else %}
    <p>Please <a href="{% url 'login' %}">login</a> to continue.</p>
{% endif %}
```

#### if-elif-else标签

多重条件判断：

```html
{% if user.is_superuser %}
    <p>You are an administrator.</p>
    <a href="{% url 'admin:index' %}">Admin Panel</a>
{% elif user.is_staff %}
    <p>You are staff member.</p>
    <a href="{% url 'staff:index' %}">Staff Panel</a>
{% else %}
    <p>You are a regular user.</p>
    <a href="{% url 'profile' %}">Your Profile</a>
{% endif %}
```

#### ifequal标签

比较两个值是否相等：

```html
{% ifequal user.username "admin" %}
    <p>Welcome, Administrator!</p>
{% endifequal %}

{% ifequal user.age 18 %}
    <p>You are exactly 18 years old!</p>
{% endifequal %}
```

#### ifnotequal标签

比较两个值是否不相等：

```html
{% ifnotequal user.status "inactive" %}
    <p>Your account is active.</p>
{% endifnotequal %}
```

### 循环标签

#### for标签

遍历列表或查询集：

```html
<ul>
{% for item in items %}
    <li>{{ item.name }} - {{ item.description }}</li>
{% empty %}
    <li>No items available.</li>
{% endfor %}
</ul>
```

#### for标签的循环变量

Django提供了一些特殊的循环变量：

```html
{% for item in items %}
    <p>{{ forloop.counter }}. {{ item.name }}</p>
    
    {% if forloop.first %}
        <p>This is the first item.</p>
    {% endif %}
    
    {% if forloop.last %}
        <p>This is the last item.</p>
    {% endif %}
    
    <p>Item {{ forloop.counter }} of {{ forloop.revcounter }}</p>
{% endfor %}
```

可用的循环变量：
- `forloop.counter`：当前循环的索引（从1开始）
- `forloop.counter0`：当前循环的索引（从0开始）
- `forloop.revcounter`：到循环结束的剩余次数（从1开始）
- `forloop.revcounter0`：到循环结束的剩余次数（从0开始）
- `forloop.first`：是否是第一次循环
- `forloop.last`：是否是最后一次循环
- `forloop.parentloop`：外层循环的forloop对象

#### 嵌套循环

```html
{% for category in categories %}
    <h3>{{ category.name }}</h3>
    <ul>
    {% for item in category.items.all %}
        <li>{{ forloop.parentloop.counter }}.{{ forloop.counter }} {{ item.name }}</li>
    {% endfor %}
    </ul>
{% endfor %}
```

### URL标签

#### url标签

生成URL，支持命名URL模式：

```html
<a href="{% url 'article-detail' article.id %}">{{ article.title }}</a>
<a href="{% url 'home' %}">Home</a>
<a href="{% url 'user-profile' user.username %}">Profile</a>
```

#### 带参数的URL

```html
<a href="{% url 'search' %}?q={{ query }}&category={{ category.id }}">Search</a>
```

### 块标签

#### block标签

定义可被子模板覆盖的块：

```html
{% block content %}
    <p>This is the default content.</p>
{% endblock %}

{% block sidebar %}
    <div class="sidebar">
        <h3>Navigation</h3>
        <ul>
            <li><a href="{% url 'home' %}">Home</a></li>
            <li><a href="{% url 'about' %}">About</a></li>
        </ul>
    </div>
{% endblock %}
```

#### extends标签

继承父模板：

```html
{% extends "base.html" %}
```

#### include标签

包含其他模板：

```html
{% include "includes/header.html" %}
{% include "includes/footer.html" %}
{% include "includes/sidebar.html" with current_page="home" %}
```

### 表单标签

#### csrf_token标签

CSRF保护：

```html
<form method="post">
    {% csrf_token %}
    <input type="text" name="title">
    <button type="submit">Submit</button>
</form>
```

#### form标签

处理表单：

```html
<form method="post" action="{% url 'contact' %}">
    {% csrf_token %}
    {{ form.as_p }}
    <button type="submit">Send Message</button>
</form>
```

### 其他常用标签

#### comment标签

多行注释：

```html
{% comment %}
    这是一个多行注释
    可以包含多行内容
    不会被渲染到HTML中
{% endcomment %}
```

#### load标签

加载自定义模板标签和过滤器：

```html
{% load static %}
{% load custom_tags %}
{% load humanize %}
```

#### now标签

显示当前日期和时间：

```html
<p>Current time: {% now "F j, Y" %}</p>
<p>Current time: {% now "H:i" %}</p>
<p>Current time: {% now "c" %}</p>
```

#### regroup标签

重新组织数据：

```html
{% regroup cities by country as country_list %}

{% for country in country_list %}
    <h3>{{ country.grouper }}</h3>
    <ul>
    {% for city in country.list %}
        <li>{{ city.name }}: {{ city.population }}</li>
    {% endfor %}
    </ul>
{% endfor %}
```

#### with标签

创建局部变量：

```html
{% with total=business.employees.count %}
    <p>Total employees: {{ total }}</p>
{% endwith %}

{% with alpha="abcdefghijklmnopqrstuvwxyz" %}
    <p>Alphabet: {{ alpha }}</p>
{% endwith %}
```

### 自定义标签

#### 创建自定义标签

在应用的`templatetags`目录下创建Python文件：

```python
# myapp/templatetags/custom_tags.py
from django import template

register = template.Library()

@register.simple_tag
def get_latest_posts(count=5):
    from .models import Post
    return Post.objects.filter(status='published')[:count]

@register.inclusion_tag('includes/recent_posts.html')
def show_recent_posts(count=5):
    from .models import Post
    latest_posts = Post.objects.filter(status='published')[:count]
    return {'latest_posts': latest_posts}
```

#### 使用自定义标签

```html
{% load custom_tags %}

<!-- 简单标签 -->
{% get_latest_posts 3 as latest_posts %}
{% for post in latest_posts %}
    <p>{{ post.title }}</p>
{% endfor %}

<!-- 包含标签 -->
{% show_recent_posts 5 %}
```

### 标签参数

标签可以接受各种参数：

```html
<!-- 字符串参数 -->
{% ifequal user.status "active" %}
    <p>User is active</p>
{% endifequal %}

<!-- 变量参数 -->
{% if user.age >= 18 %}
    <p>User is adult</p>
{% endif %}

<!-- 过滤器参数 -->
{% if user.date_joined|date:"Y" == "2023" %}
    <p>User joined in 2023</p>
{% endif %}
```

### 标签嵌套

标签可以嵌套使用：

```html
{% if user.is_authenticated %}
    {% if user.is_staff %}
        <p>Welcome, staff member!</p>
        {% if user.is_superuser %}
            <p>You have superuser privileges.</p>
        {% endif %}
    {% else %}
        <p>Welcome, regular user!</p>
    {% endif %}
{% endif %}
```

### 最佳实践

1. **保持简单**：避免在模板中进行复杂逻辑
2. **使用适当的标签**：选择合适的标签来完成特定任务
3. **避免深层嵌套**：保持模板的可读性
4. **利用循环变量**：使用`forloop`变量来增强循环功能
5. **合理使用include**：将重复的模板片段提取到单独的文件中

## 小结

- Django模板标签使用`{% %}`语法
- 提供条件判断、循环、URL生成等功能
- 支持嵌套和参数传递
- 可以创建自定义标签扩展功能
- 应该保持简单，复杂逻辑在视图中处理
