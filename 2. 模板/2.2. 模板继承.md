## 模板继承

Django模板继承是一种强大的机制，允许你创建一个基础"骨架"模板，其他模板可以继承并覆盖特定部分。这大大减少了代码重复，提高了模板的可维护性和一致性。

### 基础概念

模板继承的核心思想是：
1. **基础模板**：定义页面的基本结构和公共元素
2. **子模板**：继承基础模板，覆盖或扩展特定部分
3. **块（Block）**：定义可被子模板覆盖的内容区域

### 创建基础模板

#### 基本结构

```html
<!-- base.html -->
<!DOCTYPE html>
<html lang="zh-CN">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>{% block title %}我的网站{% endblock %}</title>
    
    <!-- 公共CSS -->
    <link rel="stylesheet" href="{% static 'css/base.css' %}">
    {% block extra_css %}{% endblock %}
</head>
<body>
    <!-- 页面头部 -->
    <header class="site-header">
        <nav class="main-nav">
            <ul>
                <li><a href="{% url 'home' %}">首页</a></li>
                <li><a href="{% url 'about' %}">关于</a></li>
                <li><a href="{% url 'contact' %}">联系</a></li>
            </ul>
        </nav>
    </header>

    <!-- 主要内容区域 -->
    <main class="main-content">
        {% block content %}
            <p>这是默认内容，子模板可以覆盖。</p>
        {% endblock %}
    </main>

    <!-- 侧边栏 -->
    <aside class="sidebar">
        {% block sidebar %}
            <div class="widget">
                <h3>最新文章</h3>
                <ul>
                    <li><a href="#">文章标题1</a></li>
                    <li><a href="#">文章标题2</a></li>
                </ul>
            </div>
        {% endblock %}
    </aside>

    <!-- 页面底部 -->
    <footer class="site-footer">
        <p>&copy; 2023 我的网站. 保留所有权利.</p>
    </footer>

    <!-- 公共JavaScript -->
    <script src="{% static 'js/base.js' %}"></script>
    {% block extra_js %}{% endblock %}
</body>
</html>
```

#### 块的定义

块使用`{% block %}`标签定义：

```html
{% block block_name %}
    <!-- 默认内容 -->
    这是默认内容
{% endblock %}
```

### 创建子模板

#### 基本继承

```html
<!-- child.html -->
{% extends "base.html" %}

{% block title %}子页面标题{% endblock %}

{% block content %}
    <h1>子页面内容</h1>
    <p>这是子页面的特定内容。</p>
{% endblock %}
```

#### 继承语法

```html
{% extends "base.html" %}
```

- `extends`标签必须是模板的第一个标签
- 路径可以是相对路径或绝对路径
- 支持模板名称变量：`{% extends template_name %}`

### 块的使用

#### 覆盖块内容

```html
{% extends "base.html" %}

{% block title %}博客文章 - {{ article.title }}{% endblock %}

{% block content %}
    <article class="blog-post">
        <h1>{{ article.title }}</h1>
        <div class="meta">
            <span class="author">作者: {{ article.author }}</span>
            <span class="date">发布时间: {{ article.published_date|date:"Y-m-d" }}</span>
        </div>
        <div class="content">
            {{ article.content|linebreaks }}
        </div>
    </article>
{% endblock %}
```

#### 保留父模板内容

使用`{{ block.super }}`可以保留父模板的块内容：

```html
{% extends "base.html" %}

{% block extra_css %}
    {{ block.super }}  <!-- 保留父模板的CSS -->
    <link rel="stylesheet" href="{% static 'css/blog.css' %}">
{% endblock %}

{% block content %}
    {{ block.super }}  <!-- 保留父模板的内容 -->
    <div class="blog-specific-content">
        <!-- 博客特定内容 -->
    </div>
{% endblock %}
```

#### 条件块

```html
{% extends "base.html" %}

{% block sidebar %}
    {% if user.is_authenticated %}
        <div class="user-widget">
            <h3>欢迎, {{ user.username }}!</h3>
            <ul>
                <li><a href="{% url 'profile' %}">个人资料</a></li>
                <li><a href="{% url 'logout' %}">退出</a></li>
            </ul>
        </div>
    {% else %}
        {{ block.super }}  <!-- 显示默认侧边栏 -->
    {% endif %}
{% endblock %}
```

### 多层继承

#### 中间层模板

```html
<!-- blog_base.html -->
{% extends "base.html" %}

{% block extra_css %}
    {{ block.super }}
    <link rel="stylesheet" href="{% static 'css/blog.css' %}">
{% endblock %}

{% block sidebar %}
    <div class="blog-sidebar">
        <div class="widget">
            <h3>分类</h3>
            <ul>
                {% for category in categories %}
                    <li><a href="{% url 'category' category.slug %}">{{ category.name }}</a></li>
                {% endfor %}
            </ul>
        </div>
        
        <div class="widget">
            <h3>标签</h3>
            <div class="tag-cloud">
                {% for tag in tags %}
                    <a href="{% url 'tag' tag.slug %}" class="tag">{{ tag.name }}</a>
                {% endfor %}
            </div>
        </div>
    </div>
{% endblock %}
```

#### 最终子模板

```html
<!-- article_detail.html -->
{% extends "blog_base.html" %}

{% block title %}{{ article.title }} - 博客{% endblock %}

{% block content %}
    <article class="article-detail">
        <header class="article-header">
            <h1>{{ article.title }}</h1>
            <div class="article-meta">
                <span class="author">作者: {{ article.author.get_full_name }}</span>
                <span class="date">{{ article.published_date|date:"Y年m月d日" }}</span>
                <span class="category">分类: {{ article.category.name }}</span>
            </div>
        </header>
        
        <div class="article-content">
            {{ article.content|safe }}
        </div>
        
        <footer class="article-footer">
            <div class="tags">
                标签: 
                {% for tag in article.tags.all %}
                    <a href="{% url 'tag' tag.slug %}" class="tag">{{ tag.name }}</a>
                {% endfor %}
            </div>
        </footer>
    </article>
{% endblock %}
```

### 包含模板

#### 使用include标签

```html
<!-- base.html -->
<!DOCTYPE html>
<html>
<head>
    <title>{% block title %}我的网站{% endblock %}</title>
</head>
<body>
    {% include "includes/header.html" %}
    
    <main>
        {% block content %}{% endblock %}
    </main>
    
    {% include "includes/footer.html" %}
</body>
</html>
```

#### 包含模板文件

```html
<!-- includes/header.html -->
<header class="site-header">
    <div class="container">
        <div class="logo">
            <a href="{% url 'home' %}">
                <img src="{% static 'images/logo.png' %}" alt="Logo">
            </a>
        </div>
        
        <nav class="main-nav">
            <ul>
                <li><a href="{% url 'home' %}">首页</a></li>
                <li><a href="{% url 'blog' %}">博客</a></li>
                <li><a href="{% url 'about' %}">关于</a></li>
                <li><a href="{% url 'contact' %}">联系</a></li>
            </ul>
        </nav>
        
        <div class="user-menu">
            {% if user.is_authenticated %}
                <span>欢迎, {{ user.username }}</span>
                <a href="{% url 'logout' %}">退出</a>
            {% else %}
                <a href="{% url 'login' %}">登录</a>
                <a href="{% url 'register' %}">注册</a>
            {% endif %}
        </div>
    </div>
</header>
```

#### 传递变量到包含模板

```html
{% include "includes/sidebar.html" with current_page="blog" show_categories=True %}
```

### 高级继承技巧

#### 动态块名称

```html
{% extends "base.html" %}

{% block sidebar %}
    {% if user.is_staff %}
        {% block staff_sidebar %}
            <div class="staff-widget">
                <h3>管理面板</h3>
                <ul>
                    <li><a href="{% url 'admin:index' %}">后台管理</a></li>
                    <li><a href="{% url 'moderate_comments' %}">评论审核</a></li>
                </ul>
            </div>
        {% endblock %}
    {% endif %}
    
    {% block public_sidebar %}
        {{ block.super }}
    {% endblock %}
{% endblock %}
```

#### 块组合

```html
{% extends "base.html" %}

{% block extra_css %}
    {{ block.super }}
    <link rel="stylesheet" href="{% static 'css/forms.css' %}">
    <link rel="stylesheet" href="{% static 'css/buttons.css' %}">
{% endblock %}

{% block extra_js %}
    {{ block.super }}
    <script src="{% static 'js/forms.js' %}"></script>
    <script src="{% static 'js/validation.js' %}"></script>
{% endblock %}
```

#### 条件继承

```html
{% if mobile %}
    {% extends "mobile_base.html" %}
{% else %}
    {% extends "desktop_base.html" %}
{% endif %}

{% block content %}
    <!-- 内容 -->
{% endblock %}
```

### 实际应用示例

#### 博客系统模板结构

```
templates/
├── base.html              # 基础模板
├── blog/
│   ├── blog_base.html     # 博客基础模板
│   ├── post_list.html     # 文章列表
│   ├── post_detail.html   # 文章详情
│   └── post_form.html     # 文章表单
├── auth/
│   ├── auth_base.html     # 认证基础模板
│   ├── login.html         # 登录页面
│   └── register.html      # 注册页面
└── includes/
    ├── header.html        # 页面头部
    ├── footer.html        # 页面底部
    ├── sidebar.html       # 侧边栏
    └── pagination.html    # 分页组件
```

#### 完整的博客基础模板

```html
<!-- blog/blog_base.html -->
{% extends "base.html" %}

{% block extra_css %}
    {{ block.super }}
    <link rel="stylesheet" href="{% static 'css/blog.css' %}">
    <link rel="stylesheet" href="{% static 'css/syntax-highlighting.css' %}">
{% endblock %}

{% block content %}
    <div class="blog-container">
        <div class="blog-main">
            {% block blog_content %}{% endblock %}
        </div>
        
        <div class="blog-sidebar">
            {% block blog_sidebar %}
                {% include "includes/blog_sidebar.html" %}
            {% endblock %}
        </div>
    </div>
{% endblock %}

{% block extra_js %}
    {{ block.super }}
    <script src="{% static 'js/blog.js' %}"></script>
    <script src="{% static 'js/syntax-highlighting.js' %}"></script>
{% endblock %}
```

#### 文章详情页面

```html
<!-- blog/post_detail.html -->
{% extends "blog/blog_base.html" %}

{% block title %}{{ post.title }} - {{ block.super }}{% endblock %}

{% block blog_content %}
    <article class="post-detail">
        <header class="post-header">
            <h1 class="post-title">{{ post.title }}</h1>
            
            <div class="post-meta">
                <span class="post-author">
                    <i class="icon-user"></i>
                    {{ post.author.get_full_name|default:post.author.username }}
                </span>
                
                <span class="post-date">
                    <i class="icon-calendar"></i>
                    {{ post.published_date|date:"Y年m月d日" }}
                </span>
                
                <span class="post-category">
                    <i class="icon-folder"></i>
                    <a href="{% url 'category' post.category.slug %}">{{ post.category.name }}</a>
                </span>
                
                <span class="post-views">
                    <i class="icon-eye"></i>
                    {{ post.views }} 次浏览
                </span>
            </div>
        </header>
        
        <div class="post-content">
            {{ post.content|safe }}
        </div>
        
        <footer class="post-footer">
            <div class="post-tags">
                <i class="icon-tags"></i>
                {% for tag in post.tags.all %}
                    <a href="{% url 'tag' tag.slug %}" class="tag">{{ tag.name }}</a>
                {% endfor %}
            </div>
            
            <div class="post-share">
                <span>分享到:</span>
                <a href="#" class="share-btn share-weibo">微博</a>
                <a href="#" class="share-btn share-wechat">微信</a>
                <a href="#" class="share-btn share-qq">QQ</a>
            </div>
        </footer>
    </article>
    
    <!-- 相关文章 -->
    {% if related_posts %}
        <section class="related-posts">
            <h3>相关文章</h3>
            <div class="post-grid">
                {% for related_post in related_posts %}
                    <article class="post-card">
                        <h4><a href="{% url 'post_detail' related_post.slug %}">{{ related_post.title }}</a></h4>
                        <p>{{ related_post.excerpt|truncatewords:20 }}</p>
                    </article>
                {% endfor %}
            </div>
        </section>
    {% endif %}
    
    <!-- 评论区 -->
    {% include "includes/comments.html" %}
{% endblock %}
```

### 最佳实践

#### 1. 合理设计继承层次

```
base.html (最基础)
├── content_base.html (内容页面基础)
│   ├── blog_base.html (博客页面基础)
│   │   ├── post_list.html
│   │   └── post_detail.html
│   └── page_base.html (静态页面基础)
│       ├── about.html
│       └── contact.html
└── auth_base.html (认证页面基础)
    ├── login.html
    └── register.html
```

#### 2. 使用有意义的块名称

```html
{% block page_title %}{% endblock %}      <!-- 页面标题 -->
{% block page_description %}{% endblock %} <!-- 页面描述 -->
{% block page_keywords %}{% endblock %}   <!-- 页面关键词 -->
{% block main_content %}{% endblock %}    <!-- 主要内容 -->
{% block sidebar_content %}{% endblock %} <!-- 侧边栏内容 -->
{% block footer_content %}{% endblock %}  <!-- 页脚内容 -->
```

#### 3. 提供合理的默认内容

```html
{% block page_title %}我的网站{% endblock %}
{% block page_description %}欢迎访问我的网站{% endblock %}
{% block main_content %}
    <p>这是默认内容，子模板应该覆盖此块。</p>
{% endblock %}
```

#### 4. 使用include减少重复

```html
<!-- 将常用的组件提取到include文件 -->
{% include "includes/breadcrumb.html" %}
{% include "includes/pagination.html" %}
{% include "includes/social_share.html" %}
```

### 常见问题和解决方案

#### 1. 块名称冲突

```html
<!-- 使用命名空间避免冲突 -->
{% block blog_sidebar %}{% endblock %}
{% block user_sidebar %}{% endblock %}
{% block admin_sidebar %}{% endblock %}
```

#### 2. 条件继承

```html
{% if user.is_staff %}
    {% extends "admin_base.html" %}
{% else %}
    {% extends "user_base.html" %}
{% endif %}
```

#### 3. 动态模板选择

```html
{% extends template_name|default:"base.html" %}
```

## 小结

- Django模板继承通过`{% extends %}`和`{% block %}`实现
- 支持多层继承和块覆盖
- 使用`{{ block.super }}`可以保留父模板内容
- 合理设计继承层次可以提高代码复用性
- 结合`{% include %}`标签可以进一步减少重复
- 遵循最佳实践可以创建清晰、可维护的模板结构