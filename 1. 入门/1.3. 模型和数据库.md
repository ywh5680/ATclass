## 数据库配置

在Django项目中，数据库配置位于项目的`settings.py`文件中。Django默认使用SQLite数据库，这是一种轻量级的数据库，适合入门学习和小型应用。

```python
# mysite/settings.py

DATABASES = {
    'default': {
        'ENGINE': 'django.db.backends.sqlite3',
        'NAME': BASE_DIR / 'db.sqlite3',
    }
}
```

SQLite是一个轻量级的磁盘数据库，不需要单独的服务器进程，非常适合初学者使用。在开发阶段，我们通常不需要修改这个默认配置。

## 模型定义

模型是Django应用程序中数据结构的定义，它描述了数据库中的表结构。每个模型通常对应数据库中的一个表。

### 创建模型

在Django中，模型被定义为Python类，继承自`django.db.models.Model`。每个模型类的属性对应数据库表中的一个字段。

以投票应用为例，我们可以创建两个模型：`Question`和`Choice`：

```python
# polls/models.py
from django.db import models

class Question(models.Model):
    question_text = models.CharField(max_length=200)
    pub_date = models.DateTimeField('date published')
    
    def __str__(self):
        return self.question_text

class Choice(models.Model):
    question = models.ForeignKey(Question, on_delete=models.CASCADE)
    choice_text = models.CharField(max_length=200)
    votes = models.IntegerField(default=0)
    
    def __str__(self):
        return self.choice_text
```

在这个例子中：
- `Question`模型包含问题文本和发布日期
- `Choice`模型包含选项文本、投票计数，以及与`Question`的外键关系

## 常用字段类型

Django提供了多种字段类型用于定义模型属性：

- **CharField**：字符串字段，适用于小到中等长度的字符串，必须指定`max_length`参数
- **TextField**：大文本字段，适用于大量文本
- **IntegerField**：整数字段
- **DateField**：日期字段
- **DateTimeField**：日期时间字段
- **BooleanField**：布尔字段（True/False）
- **ForeignKey**：多对一关系，需要指定`on_delete`参数

## 激活模型

在创建模型后，需要将应用添加到项目的`INSTALLED_APPS`设置中：

```python
# mysite/settings.py
INSTALLED_APPS = [
    'polls.apps.PollsConfig',
    'django.contrib.admin',
    'django.contrib.auth',
    'django.contrib.contenttypes',
    'django.contrib.sessions',
    'django.contrib.messages',
    'django.contrib.staticfiles',
]
```

## 数据库迁移

Django使用迁移系统来将模型的更改传播到数据库架构中。

### 创建迁移文件

```bash
python manage.py makemigrations polls
```

这将创建一个迁移文件，记录了模型的变化：

```
Migrations for 'polls':
  polls/migrations/0001_initial.py
    - Create model Question
    - Create model Choice
```

### 应用迁移

```bash
python manage.py migrate
```

这将在数据库中创建模型对应的表。

## 使用Django API操作数据库

Django提供了简单的数据库API，用于创建、检索、更新和删除数据库中的记录。

### 创建对象

```python
# 创建并保存
from django.utils import timezone
q = Question(question_text="What's new?", pub_date=timezone.now())
q.save()
```

### 查询对象

```python
# 获取所有记录
all_questions = Question.objects.all()

# 获取单个对象
q = Question.objects.get(pk=1)
```

### 关联对象查询

```python
# 获取关联对象
q = Question.objects.get(pk=1)
choices = q.choice_set.all()

# 创建关联对象
q.choice_set.create(choice_text="Not much", votes=0)
```

## 小结

- Django模型是Python类，继承自`django.db.models.Model`
- 模型字段定义了数据库表的结构
- 迁移系统用于将模型变更应用到数据库
- Django提供了简单的API用于数据库操作
